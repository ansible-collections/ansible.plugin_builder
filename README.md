# Ansible Content Builder Collection

This repository contains the `ansible.content_builder` Ansible Collection.

## Tested with Ansible

Tested with ansible-core 2.13 releases and the current development version of ansible-core.

## Installation

```
pip install jsonschema jinja2==3.0.3 ansible-core
ansible-galaxy collection install git+https://github.com/ansible-community/ansible.content_builder.git
```

You can also include it in a `requirements.yml` file and install it via `ansible-galaxy collection install -r requirements.yml` using the format:

```yaml
collections:
- name: ansible.content_builder
```

See [Ansible Using collections](https://docs.ansible.com/ansible/latest/user_guide/collections_using.html) for more details.

## Using this collection

build.yaml
```yaml
---
- hosts: localhost
  gather_facts: yes
  roles:
    - ansible.content_builder.run
```
MANIFEST.yaml
```yaml
---
collection:
  path: /path/to/collection
  namespace: test_namespace
  name: test_name
plugins:
  - type: action
    name: custom_action
    docstring: /path/to/docstring.yaml
  
  - type: cache
    name: custom_cache
    docstring: /path/to/docstring.yaml
  
  - type: filter
    name: custom_filter
    docstring: /path/to/docstring.yaml

  - type: test
    name: custom_test
    docstring: /path/to/docstring.yaml
  
  - type: lookup
    name: custom_lookup
    docstring: /path/to/docstring.yaml
  
  - type: module_openapi
    name: deepsec_intrusion_prevention_rules
    module_version: 1.0.0
    rm_swagger_json: /swagger_tm.json
    api_object_path: /intrusionpreventionrules
    resource: intrusion_prevention_rules
    unique_key: ""
    author: "Ansible Team"
```

```
ansible-playbook build.yaml -e manifest_file=MANIFEST.yaml 
```

## Supported plugins

| **Plugin Type**        | **Description**                                                      |
|------------------------|----------------------------------------------------------------------|
| action                 | Scaffold a action plugin                                             |
| cache                  | Scaffold a cache plugin                                              |
| filter                 | Scaffold a filter plugin                                             |
| test                   | Scaffold a test plugin                                               |
| lookup                 | Scaffold a lookup plugin                                             |
| module_network_cli     | Scaffold a Network Resource Module that support network_cli          |
| module_network_netconf | Scaffold a Network Resource Module that supports netconf             |
| module_openapi         | Scaffold a Resource Module generated using OpenApi swagger JSON file |

### Resource module scaffolding generated using OpenApi based JSON

Giving `module_openapi` as an input to Ansible.content builder scaffolding tool helps Ansible content developers scaffold and output Ansible Resource Modules (RM) based out of OPENAPI based swagger JSON file, using HTTPAPI connection plugin for the platform configuration.

**Capabilities:**
- Use a pre-defined OPENAPI based swagger JSON file or other JSON file to scaffold a resource module in an Ansible Collection.
- Generates working resource module file `<vendor>_<resource>.py` and relevant action logic file both `action/<vendor>_<resource>.py`.

**Input Parameters:**

- *collection:path*: Destination folder where the user wants the output of the scaffolding tool to be stored.
- *collection:namespace*: Ansible collection org name.
- *collection:name*: Ansible collection name.
- *plugin:rm_swagger_json*: Swagger JSON/JSON file where OEMs API with all of its REST operations are defined.
- *plugin:api_object_path*: API for which resource module needs to be generated by the tool.
- *plugin:name*: Ansible module name against the API.
- *plugin:resource*: API resource.
- *plugin:unique_key*: Unique key for API.
- *plugin:author*: Author for the resource module.

#### Builing a new module/collection:

Currently, the tool is optimised to parse Trendmicro Deepsecurity, Fortinet and CheckPoint swagger JSON files to output Resource modules for respective platforms.

#### Examples:

#### 1. Trendmicro Deepsecurity

MANIFEST.yaml:
```yaml
---
collection:
  path: /tmp/trendmicro/deepsec
  namespace: trendmicro
  name: deepsec
plugins:
  - type: module_openapi
    name: deepsec_intrusion_prevention_rules
    module_version: 1.0.0
    rm_swagger_json: /swagger_tm.json
    api_object_path: /intrusionpreventionrules
    resource: intrusion_prevention_rules
    unique_key: ""
    author: "Ansible Team"
```

#### 2. Fortinet

MANIFEST.yaml:
```yaml
---
collection:
  path: /tmp/fortinet/fortios
  namespace: fortinet
  name: fortios
plugins:
  - type: module_openapi
    name: fortios_firewall_policy
    module_version: 1.0.0
    resource: firewall_policy
    rm_swagger_json: /FortiOS_7.0.3_Configuration_API_firewall.json
    api_object_path: /firewall/policy
    unique_key: policyid
    author: "Ansible Team"
```

#### 3. CheckPoint

MANIFEST.yaml:
```yaml
---
collection:
  path: /tmp/checkpoint/mgmt
  namespace: checkpoint
  name: mgmt
plugins:
  - type: module_openapi
    name: cp_mgmt_access_rules_global
    module_version: 1.0.0
    rm_swagger_json: ~/Sumit/ansible_fork/collections/security_collections/doc_generator/apis_ckp.json
    api_object_path: add-access-rule
    resource: access_rules
    unique_key: ""
    author: "Ansible Team"
```

## Licensing

GNU General Public License v3.0 or later.

See [COPYING](https://www.gnu.org/licenses/gpl-3.0.txt) to see the full text.
